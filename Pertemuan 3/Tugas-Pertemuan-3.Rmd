---
title: "Tugas-Pertemuan-3"
output: html_document
editor_options: 
  markdown: 
    wrap: 72
---

Nama: Aliyah Nadhratunnaim

NIM: G1401231087

# Import Library dan Data

```{r}
library(dLagM)
library(nardl)
library(quantmod)
library(dynlm)
library(zoo)
library(MLmetrics)
library(lmtest)
library(car)
library(carData)
library(readr)
library(ggplot2)
library(corrplot)
```

```{r}
data <- read.csv("C:/Users/User/Downloads/NewDelhi_Air_quality.csv")
data
```

# Pembagian Data

Data dibagi menjadi 80% train dan 20% data test

```{r}
#SPLIT DATA
train<-data[1:58,]
test<-data[59:72,]
```

```{r}
#data time series
train.ts<-ts(train)
test.ts<-ts(test)
data.ts<-ts(data)
```

# Pemodelan Koyck

```{r}
model.koyck <- koyckDlm(x = train$o3, y = train$AQI)
summary(model.koyck)
```

```{r}
AIC(model.koyck)
```

```{r}
BIC(model.koyck)
```

Dari hasil tersebut, didapatkan bahwa peubah $x_t$ dan $y_{t-1}$
memiliki nilai p-value \< 0,05. Hal ini menunjukkan bahwa peubah $x_t$
dan $y_{t-1}$ berpengaruh signifikan terhadap $y$.

## Peramalan dan Akurasi

Berikut adalah hasil peramalan y untuk 5 periode kedepan menggunakan
model koyck

```{r}
fore.koyck <- forecast(model = model.koyck, x=test$o3, h=14)
fore.koyck
```

```{r}
mape.koyck <- MAPE(fore.koyck$forecasts, test$AQI)
mape.koyck #data test
```

```{r}
GoF(model.koyck)
```

# Regression with Distributed Lag

## Pemodelan (Lag = 2)

```{r}
model.dlm <- dlm(x = train$o3,y = train$AQI , q = 1)
summary(model.dlm)
```

```{r}
AIC(model.dlm)
```

```{r}
BIC(model.dlm)
```

Dari hasil di atas, didapat bahwa p-value dari $x_t$ \< 0,05. Hal ini
menunjukkan bahwa $x_t$ berpengaruh signifikan terhadap $y$.

## Peramalan dan Akurasi

```{r}
fore.dlm <- forecast(model = model.dlm, x=test$o3, h=14)
fore.dlm
```

```{r}
mape.dlm <- MAPE(fore.dlm$forecasts, test$AQI)
mape.dlm
```

```{r}
GoF(model.dlm)
```

## Lag Optimum

```{r}
#penentuan lag optimum 
finiteDLMauto(formula = AQI ~ o3,
              data = data.frame(train), q.min = 1, q.max = 30,
              model.type = "dlm", error.type = "AIC", trace = TRUE)
```

Berdasarkan output tersebut, lag optimum didapatkan ketika lag=27.
Selanjutnya dilakukan pemodelan untuk lag=27

```{r}
#model dlm dengan lag optimum
model.dlm2 <- dlm(x = train$o3,y = train$AQI , q = 27)
summary(model.dlm2)
```

```{r}
AIC(model.dlm2)
```

```{r}
BIC(model.dlm2)
```

Dari hasil tersebut terdapat beberapa peubah yang berpengaruh signifikan
terhadap taraf nyata 5% yaitu intercept,
$x_t, x_{t-8}, x_{t-9}, x_{t-11}, x_{t-21}, x_{t-23}, x_{t-24}, x_{t-24}.$

```{r}
#peramalan dan akurasi
fore.dlm2 <- forecast(model = model.dlm2, x=test$o3, h=14)

#akurasi data test
mape.dlm2<- MAPE(fore.dlm2$forecasts, test$AQI)
mape.dlm2
```

```{r}
#akurasi data training
GoF(model.dlm2)
```

Model tersebut merupakan model yang sangat baik dengan nilai MAPE yang
kurang dari 10%.

# Model Autoregressive

```{r}
model.ardl <- ardlDlm(x = train$o3, y = train$AQI, p = 1 , q = 1)
summary(model.ardl)
```

```{r}
AIC(model.ardl)
```

```{r}
BIC(model.ardl)
```

```{r}
model.ardl <- ardlDlm(formula = AQI ~ o3, 
                         data = train,p = 1 , q = 1)
summary(model.ardl)
```

```{r}
AIC(model.ardl)
```

```{r}
BIC(model.ardl)
```

Hasil estimasi menunjukkan bahwa selain peubah intersep, seluruh peubah
dalam model memiliki nilai-p \< 0,05. Hal ini mengindikasikan bahwa
peubah $x_t$, $x_{t-1}$, dan $y_{t-1}$ berpengaruh signifikan terhadap
$y_t$.

## Peramalan dan Akurasi

```{r}
fore.ardl <- forecast(model = model.ardl, x=test$o3, h=14)
fore.ardl
```

```{r}
mape.ardl <- MAPE(fore.ardl$forecasts, test$AQI)
mape.ardl
```

```{r}
#akurasi data training
GoF(model.ardl)
```

## Lag Optimum

```{r}
#penentuan lag optimum
model.ardl.opt <- ardlBoundOrders(data = data.frame(data), ic = "AIC", 
                                  formula = AQI ~ o3 )
model.ardl.opt
```

```{r}
min_p=c()
for(i in 1:15){
  min_p[i]=min(model.ardl.opt$Stat.table[[i]])
}
q_opt=which(min_p==min(min_p, na.rm = TRUE))
p_opt=which(model.ardl.opt$Stat.table[[q_opt]] == 
              min(model.ardl.opt$Stat.table[[q_opt]], na.rm = TRUE))
data.frame("q_optimum" = q_opt, "p_optimum" = p_opt, 
           "AIC"=model.ardl.opt$min.Stat)
```

Didapatkan model optimum dengan p = 13 dan q = 2

# Perbandingan Model

```{r}
akurasi <- matrix(c(mape.koyck, mape.dlm, mape.dlm2, mape.ardl))
row.names(akurasi)<- c("Koyck","DLM 1","DLM 2","Autoregressive")
colnames(akurasi) <- c("MAPE")
akurasi
```

Dari tabel tersebut terlihat bahwa model **Autoregressive** memiliki
nilai MAPE terkecil, yaitu **0,00779**, yang menunjukkan kemampuan
prediksi paling akurat dibandingkan model lainnya. DLM 1 berada pada
urutan kedua dengan MAPE sebesar 0,00855, diikuti oleh Koyck (0,0291),
sedangkan DLM 2 memiliki kesalahan prediksi terbesar (0,20231).

Berdasarkan temuan ini, **model Autoregressive** direkomendasikan
sebagai model peramalan terbaik untuk digunakan dalam analisis dan
prediksi selanjutnya.
